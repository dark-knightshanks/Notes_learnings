### *INTRODUCTION*
SPI stands for **Serial Peripheral Interface**, a synchronous serial communication interface often used in embedded systems for short-distance communication between integrated circuits. The master initiates communication, generates the clock signal, and selects the desired slave device.

### FEATURES

The standard SPI interface utilizes four main lines for communication: 

- **SCLK (Serial Clock):** Generated by the master to synchronise data transfer.
- **MOSI (Master Out Slave In):** Carries data from the master to the slave.
- **MISO (Master In Slave Out):** Carries data from the slave to the master.
- **CS/SS (Chip Select/Slave Select):** Used by the master to select the specific slave device.
- SPI operates in a master-slave model, where a single master device controls the communication with one or more slave devices.
- Often used for data transfer between a (smart) controller and a (less smart) peripheral device - Common applications include ***sensors, displays, ADC(ANALOG TO DIGITAL CONVERTER)/DAC, RTC, game controllers***, etc.

So lets dive into each of these features and see how we can configure these registers to initiate a communication protocol between devices .

- ***CS*** : We can use this to select a target(slave) by pulling it low. Thus this allows slaves to listen for the SCLK and MOSI. We keep it low until communication is complete. Simple way to address targets unlike I2C which uses explicit addresses. A single or multiple CS line can be used to address multiple devices.
- ***SCLK*** : Clock signal is generated by the master. Slaves do not require their own clocks, even when they are transmitting data. Speed usually into the MHz range. Faster than **UART** or **I2C**. So, essentially, SCLK ensures that the Master and Slave are always in sync and know exactly when to transmit or read data, preventing any timing issues or misinterpretations. Without it, the data wouldn't be able to be reliably transferred between the devices.
- ***MOSI*** : MOSI is the dedicated channel for the Master to send instructions, commands, or data to the Slave, bit by bit, in perfect sync with the clock. Each time the SCLK metronome ticks, a single piece of information (a bit) is sent from the Master to the Slave over the MOSI line. Number of bytes depends on implementation, multiple bytes can be sent sequentially. 
- ***MISO*** : When the Slave needs to send information or a response back to the Master, it speaks through the MISO line. Each time the SCLK metronome ticks, a single piece of information (a bit) is sent from the Slave to the Master over the MISO line, ensuring they stay synchronised. Not all SPI implementations use MISO, some devices only receive data from master for e.g. ***oled displays*** etc. MISO is sent as response to data on MOSI.

![[Pasted image 20250723120132.png]]

![[Pasted image 20250723121404.png]]

#### **Clock polarity (CPOL) and clock phase (CPHA)**

- SPI uses CPOL and CPHA to define the timing relationship between the clock and data. There are four modes (0, 1, 2, 3) with specific CPOL and CPHA settings. CPOL sets the idle state of the clock, and CPHA determines whether data is sampled on the leading or trailing edge. For example, Mode 0 uses CPOL=0 and CPHA=0.

Now for our NovaPi project we are going to use SPI for displaying SRA logo on the oled display using the above information. We are going to write drivers for the same. Now the question arises that we may have heard the term driver but are not sure about its exact meaning, so here is the definition of the driver :

- What is a driver? — A hardware/device driver allows your computer to use devices that are attached to it.
### GPIO

Raspberry Pi 4b model  has five SPI interfaces of this type: SPI0, SPI3, SPI4, SPI5 & SPI6. It has two additional mini SPI interfaces (SPI1 and SPI2). We are going to use SPI0 which is the most commonly used SPI. The base address of SPI0 is at 0xFE204000. Since we are going to display an image on oled screen we do not expect a output from the display(slave),
hence we are going to use only MOSI for data transfer. 

The gpio(peripherals) present on the Pi(BCM 2711) have been assigned various purposes/tasks according to the mode(ALT0, ALT1 ...etc) that has been selected by the user. Hence we can use SPI0 using the gpio pins 7-11 in ALT0 or pins 35-39 in ALT0. So to keep it simple we will use pins 7-11. The following is the task assigned to each  gpio pin according to the bcm manual : 
- GPIO7 -  SPI0_CE1_N (CS1)
- GPIO8 -  SPI0_CE0_N (CS0)
- GPIO9 -  SPI0_MISO
- GPIO10 - SPI0_MOSI
- GPIO11 -  SPI0_SCLK
But as i mentioned we are just using the a single display(slave) with no MISO line we are going to not use GPIO9 as well as GPIO7 since we only have one target.